#!/usr/bin/env bash
# This script installs and configures Nginx server with a custom header and creates an index.html and 404.html page

sudo set -euo pipefail  # exit script immediately if a command fails or an undefined variable is used

# Update package list and install Nginx
sudo apt-get update -yq && sudo apt-get install -yq nginx

# Set the custom header name and value
header_name="X-Served-By"
header_value=$(hostname)

# Configure Nginx to add the custom header
sudo sed -i "s/^server_tokens .*$/server_tokens off;\nadd_header $header_name $header_value;/g" /etc/nginx/nginx.conf

# Create index.html page
echo "Hello World!" | sudo tee /var/www/html/index.html >/dev/null

# Create 404.html page
echo "Ceci n'est pas une page" |sudo tee /var/www/html/404.html >/dev/null

# Configure redirection
sudo sed -i '/location \/redirect_me {/a\return 301 https:\/\/www.youtube.com/@chineduelijah9785\/;' /etc/nginx/sites-available/default

# Test configuration
sudo nginx -t

# Reload Nginx configuration
sudo service nginx restart
